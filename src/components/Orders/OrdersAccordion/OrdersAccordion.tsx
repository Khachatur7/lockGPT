import React, { Dispatch } from "react";
import { SetStateAction } from "react";
import { deleteForm, Form } from "../../../api/orders";
import styles from "./OrdersAccordion.module.css";
import cn from 'classnames';
import { useNavigate } from "react-router-dom";

interface OrdersAccordionProps {
	form: Form;
	setForms: Dispatch<SetStateAction<Form[]>>;
}

const OrdersAccordion: React.FC<OrdersAccordionProps> = ({ form, setForms }) => {
	const navigate = useNavigate();

	const handleDeleteForm = async (e: React.MouseEvent) => {
		e.stopPropagation();
		try {
			await deleteForm(form.id);
			setForms((prev) => prev.filter((f) => f.id !== form.id));
		} catch (error: unknown) {
			console.log(`Ошибка при удалении формы: ${error}`);
			alert("Не удалось удалить форму. Попробуйте ещё раз.");
		}
	};

	const handleNavigateToSettings = (e: React.MouseEvent) => {
		e.stopPropagation();
		navigate(`${form.id}/settings`);
	};

	return (
		<div className={styles['accordion']}>
			<div className={styles['head']}>
				<div className={styles['left']}>
					<button className={styles['title']} onClick={handleNavigateToSettings}>{form.name}</button>
				</div>
				<div className={styles['right']}>
					<button className={cn(styles['accordion-btn'], styles['settings'])} onClick={handleNavigateToSettings}>
						<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path fill-rule="evenodd" clip-rule="evenodd" d="M10 6.875C8.27411 6.875 6.875 8.27411 6.875 10C6.875 11.7259 8.27411 13.125 10 13.125C11.7259 13.125 13.125 11.7259 13.125 10C13.125 8.27411 11.7259 6.875 10 6.875ZM8.125 10C8.125 8.9645 8.9645 8.125 10 8.125C11.0355 8.125 11.875 8.9645 11.875 10C11.875 11.0355 11.0355 11.875 10 11.875C8.9645 11.875 8.125 11.0355 8.125 10Z" fill="#233566"/>
							<path fill-rule="evenodd" clip-rule="evenodd" d="M10 1.0415C9.41283 1.0415 8.87658 1.20283 8.29048 1.47515C7.7234 1.73864 7.06699 2.12737 6.24547 2.61388L5.6179 2.98553C4.79611 3.47219 4.13976 3.86087 3.63397 4.2327C3.11096 4.6172 2.70981 5.01076 2.41945 5.5266C2.12957 6.04162 1.99868 6.59229 1.93588 7.24572C1.87499 7.87933 1.87499 8.65525 1.875 9.62984V10.3698C1.87499 11.3444 1.87499 12.1203 1.93588 12.7539C1.99868 13.4074 2.12957 13.9581 2.41945 14.4731C2.70981 14.9889 3.11096 15.3825 3.63397 15.767C4.13976 16.1388 4.79611 16.5275 5.6179 17.0142L6.2455 17.3858C7.06698 17.8723 7.72342 18.2611 8.29048 18.5245C8.87658 18.7968 9.41283 18.9582 10 18.9582C10.5872 18.9582 11.1234 18.7968 11.7095 18.5245C12.2766 18.261 12.933 17.8723 13.7545 17.3858L14.3821 17.0142C15.2038 16.5275 15.8602 16.1388 16.366 15.767C16.8891 15.3825 17.2902 14.9889 17.5806 14.4731C17.8704 13.9581 18.0013 13.4074 18.0641 12.7539C18.125 12.1203 18.125 11.3444 18.125 10.3699V9.62984C18.125 8.65534 18.125 7.87932 18.0641 7.24572C18.0013 6.59229 17.8704 6.04162 17.5806 5.5266C17.2902 5.01076 16.8891 4.6172 16.366 4.2327C15.8602 3.86087 15.2039 3.4722 14.3821 2.98555L13.7545 2.61388C12.933 2.12736 12.2766 1.73864 11.7095 1.47515C11.1234 1.20283 10.5872 1.0415 10 1.0415ZM6.85437 3.70604C7.71032 3.19915 8.31338 2.84285 8.81725 2.60875C9.3085 2.38047 9.65892 2.2915 10 2.2915C10.3411 2.2915 10.6915 2.38047 11.1827 2.60875C11.6866 2.84285 12.2897 3.19915 13.1457 3.70604L13.7174 4.04466C14.5732 4.55148 15.1757 4.90913 15.6257 5.23984C16.0639 5.56206 16.3175 5.83105 16.4912 6.13974C16.6655 6.44924 16.7666 6.81142 16.8198 7.36529C16.8743 7.9322 16.875 8.64817 16.875 9.66125V10.3384C16.875 11.3515 16.8743 12.0675 16.8198 12.6343C16.7666 13.1883 16.6655 13.5504 16.4912 13.8599C16.3175 14.1686 16.0639 14.4376 15.6257 14.7598C15.1757 15.0906 14.5732 15.4482 13.7174 15.955L13.1457 16.2937C12.2897 16.8005 11.6866 17.1568 11.1827 17.3909C10.6915 17.6192 10.3411 17.7082 10 17.7082C9.65892 17.7082 9.3085 17.6192 8.81725 17.3909C8.31338 17.1568 7.71032 16.8005 6.85437 16.2937L6.28258 15.955C5.42675 15.4482 4.82422 15.0906 4.37436 14.7598C3.93605 14.4376 3.6825 14.1686 3.50875 13.8599C3.33454 13.5504 3.23338 13.1883 3.18015 12.6343C3.12567 12.0675 3.125 11.3515 3.125 10.3384V9.66125C3.125 8.64817 3.12567 7.9322 3.18015 7.36529C3.23338 6.81142 3.33454 6.44924 3.50875 6.13974C3.6825 5.83105 3.93605 5.56206 4.37436 5.23984C4.82422 4.90913 5.42675 4.55148 6.28258 4.04466L6.85437 3.70604Z" fill="#233566"/>
						</svg>
						<span>Настройки</span>
					</button>
					<button className={cn(styles['accordion-btn'], styles['accordion-delete'])} onClick={handleDeleteForm} >
						<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path fill-rule="evenodd" clip-rule="evenodd" d="M9.99984 1.0415C5.05229 1.0415 1.0415 5.05229 1.0415 9.99984C1.0415 14.9474 5.05229 18.9582 9.99984 18.9582C14.9474 18.9582 18.9582 14.9474 18.9582 9.99984C18.9582 5.05229 14.9474 1.0415 9.99984 1.0415ZM2.2915 9.99984C2.2915 5.74264 5.74264 2.2915 9.99984 2.2915C11.9036 2.2915 13.6462 2.98165 14.991 4.12539C14.9854 4.13055 14.98 4.13583 14.9746 4.14123L4.14124 14.9743C4.13581 14.9798 4.1305 14.9853 4.1253 14.9909C2.98161 13.6461 2.2915 11.9036 2.2915 9.99984ZM5.00859 15.8742C6.35344 17.018 8.09604 17.7082 9.99984 17.7082C14.257 17.7082 17.7082 14.257 17.7082 9.99984C17.7082 8.09609 17.018 6.35352 15.8743 5.00869C15.8691 5.01424 15.8638 5.01972 15.8584 5.02512L5.02512 15.8583C5.01969 15.8637 5.01417 15.869 5.00859 15.8742Z" fill="#233566"/>
						</svg>
						<span>Удалить</span>
					</button>
				</div>
			</div>
		</div>
	);
};

export default OrdersAccordion;
